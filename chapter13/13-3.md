#### 13-3 자바스크립트 프로그램의 실행

자바스크립트는 두 단계로 나뉘어서 실행된다.  
첫 단계에서는 문서를 불러오고 `<script>`요소의 코드를 실행한다.  
문서를 불러온 후 모든 스크립트를 실행하면 자바스크립트 실행은 두 번째 단계로 넘어간다.  
두 번째 단계에서는 이벤트를 중심으로 비동기적으로 자바스크립트가 실행된다.

#### 13-3-1 동기, 비동기, 연기된 스크립트

HTML 파서는 script 요소를만나면 문서 파싱과 렌더링을 계속 진행하기 전에 기본적으로  
스크립트를 먼저 실행한다.  
스크립트를 다운로드하고 실행을 완료할 때 까지 문서 파싱은 진행되지 않는다.

이러한 문제를 해결하기 위해 `script` 태그에 defer와 async 속성을 사용한다.

defer 속성은 브라우저 문서를 모두 불러오고 파싱해서 조작할 준비가 끝날 때까지 스크립트  
실행을 미룬다.
또한 스크립트도 순서대로 실행된다.

sync 속성은 스크립트를 다운로드하는 동안에도 문서 파싱을 계속하고, 문서 파싱 완료와  
관계없이 가급적 빨리 스크립트를 실행한다.  
또한 스크립트는 순서와 관계없이 불러오는 대로 실행된다.

#### 13-3-2 이벤트가 주도하는 자바스크립트

이벤트 핸들러 함수는 등록된 요소에서 이벤트가 발생하면 호출된다.(비동기 시점)  
이벤트에는 일어날 이벤트의 일반적인 형태는 나타내는 click, change, mouseover등등 같은 이름이 붙는다.  
이벤트가 일어난 객체를 대상으로 삼는다.  
프로그램이 이벤트에 응답하려면 이벤트 핸들러, 이벤트 리스너, 경우에 따라서 콜백 함수를 작성  
해야한다.

거의 모든 이벤트에 대해 이벤트 핸들러에 이벤트 객체를 전달인자로 넘기고, 이벤트 객체의  
프로퍼티로 이벤트에 대한 상세 정보를 제공한다.

이벤트 타깃이 문서 요소일 때는 이벤트가 문서 계층 구조를 따라 상위로 올라가는데,  
이를 버블링 이라고 한다.

이벤트 전파를 멈추도록 제어하고 있지 않다면, 이벤트는 타깃에서 계속 올라가고, 이 때  
상위 요소에도 이벤트 이벤트 핸들러가 적용되어 있다면 문제가 발생할 수 있다.

이벤트 핸들러를 등록하는 방법으로는 `문서요소.addEventListener()`가 있다.  
addEventListener 함수의 첫 번째 인자는 이벤트 명이다.  
두 번째 인자는 이벤트가 발생했을 때 실행 할 함수이다.

#### 13-3-3 클라이언트 측 자바스크립트 스레드 모델

HTML5는 웹 워커라는 관리 가능한 도시성 처리 방식을 제공한다.  
웹 워커는 사용자 인터페이스를 멈추지 않고 오래 걸리는 연산을 실행할 수 있는  
백그라운드 스레드다.  
웹 워커 스레드에서 실행하는 소스는 오직 비동기 이벤트로만 통신이 가능하다.

#### 13-3-4 클라이언트 측 자바스크립트 실행 순서

```
1. Document 객체를 생성하고 웹 페이지 분석을 시작하고, HTML 요소와 그 안의 텍스트 내용을 분석해서 Element 객체와 Text 노드를 웹 페이지 문서에 추가한다.
2. <script> 요소와 만나면 문서에 추가하고 내장 스크립트, 외부 파일 구분없이 실행한다.
3. async, defer 속성이 있는 <script> 요소를 만나면 해당 속성에 맞게 실행된다.
4. 브라우저는 Document 객체에서 DOMContentLoaded 이벤트를 일으킨다.
5. 브라우저는 이 시점에서 문서를 완전히 분석했지만, 이미지 등 추가로 불러와야 하는 내용을 기다릴 수 있다.
6. 모두 불러오고 모든 비동기 스크립트도 불러와서 실행했다면 웹 브라우저는 Window 객체에 load 이벤트를 발생시킨다.
7. 이 시점부터 이벤트 핸들러는 사용자 입력 이벤트, 네트워크 이벤트 등의 응답으로 비동기 호출된다.
```
